<!DOCTYPE html>
<html>
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
        <title>Watcher üëÅÔ∏è</title>

        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëÅÔ∏è</text></svg>">

        <script type="text/javascript" src="dist/watcher.js"></script>

        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <h1>
            Set a connection string
        </h1>

        <label for="connection">SAS Connection String: </label>
        <input  autocomplete="on" type="text" id="connection"/>


        
        <div>
            <h1>
                Queue a work item
            </h1>
            <form id="submissioncontrol">
                <ul>
                    <li>
                        <label for="url">URL: </label>
                        <input type="text" id="url"/>
                    <li>
                        <label for="payloadtype">Targeted Resource: </label>
                        <select name="payload_type" id="payloadtype">
                            <option value="youtubedl">YoutubeDL</option>
                        </select>
                    </li>
                    <li>
                        <label for="qualityselection">Audio or Video: </label>

                        <select name="quality_selection" id="qualityselection">
                            <option value="bestaudio+bestvideo">Audio + Video</option>
                            <option value="bestaudio">Audio Only</option>
                        </select>
                    </li>
                    <li>
                        <button id="enqueue" class="button" type="button">Queue</button>
                    </li>
                </ul>
            </form>
        </div>

        <h2>
            Dequeue a workitem    
        </h2>
        <button id="dequeue">Dequeue Work</button>
        
        <h3>
            View Result Output
        </h3>
        <textarea id="viewport">Output will be displayed here.</textarea>
    </body>

    <script type="text/javascript">
        function setOutputWindowStatus(classStatus, message){
            let classlist = ["success", "failure", "loading", "unknown"];
            let outputWindow = document.getElementById("viewport");

            for(var i = 0; i < classlist.length; i++){
                outputWindow.classList.remove(classlist[i]);
            }
            outputWindow.classList.add(classStatus);
            outputWindow.innerHTML = message;
        }

        document.getElementById("enqueue").addEventListener("click", async function(event){
            let connectionValue = document.getElementById("connection").value;
            let watcherClient = new watcher.WatcherClient(connectionValue, "watcher")
            
            let payloadType = document.getElementById("payloadtype").value;
            let qualitySelection = document.getElementById("qualityselection").value;
            let url = document.getElementById("url").value;

            let payload = new watcher.WatcherPayload(payloadType, qualitySelection, url);

            try {
                setOutputWindowStatus("loading", "Adding Queue Item...");
                let result = await watcherClient.enqueue(payload);
                setOutputWindowStatus("success", JSON.stringify(result, undefined, 4));
            }
            catch(err) {
                output.classList.add("failure", JSON.stringify(err, undefined, 4));
            }
        });

        document.getElementById("dequeue").addEventListener("click", async function(event){
            let watcherClient = new watcher.WatcherClient(document.getElementById("connection").value, "watcher")

            try {
                setOutputWindowStatus("loading", "Retrieving Item From Queue...");
                let result = await watcherClient.dequeue();
                setOutputWindowStatus("success", JSON.stringify(result, undefined, 4));
            }
            catch(err){
                output.classList.add("failure", JSON.stringify(err, undefined, 4));
            }
        });
    </script>
</html>